---
title: "[VRChat] ぽた式 アバターセットアップの流れ"
emoji: "🤖"
type: "tech"
topics:
  - "vrchat"
  - "VCC"
  - "VPM"
published: ture
---
# このページについて
* ぽたぽよがいつもしているアバターセットアップの手順を記載しています。ざっくり1年やってみて、これで安定しているなという感じです。
* 「あ～ こんな方法あるんですね。」とか、「こんな方法あるよ。」など、気づきがあって、助言もらえたらいいな～みたいな気持ちです。

# 前提
* 1衣装・1アップロード・1シーン
  * Expression Parameters の上限があるし、FX Menu をすっきりさせたい。
  * 壊滅的変更があった場合でも影響を最小限に押さえたい。
    * もちろん弊害としてアバターを衣装ごとにガンガンアップすることになります。
      * アバターのお気に入りリストの上限はありますが、アップできるアバターの上限…はないらしい。マジ…？
    * ぽたは最近100体を超えたところです。

* git でバージョン管理をする。
  * 壊滅的変更を行っても戻せるようにしたい。
    * VRCLens とか リアル影システム とかは FX やらマテリアルが変わってしまうので…
    * なんか失敗してもコミットしたタイミングに戻すのが安易になります。
  * お作法……みたいなところに関して、複数人で作業する場合はいろいろルールが発生すると思うのですが、どうせ自分しか使わないので適当にやる。
    * ベースを upstream で管理するとかも自分に自信が無いのでやりません。

* git のサーバは立てない。
  * バージョン管理がしたいのであって、サーバ管理はしたくないし、うっかりアバターのデータを公開してしまうような状況から離れておきたい。
  * これに関しては、OneDrive にベアリポジトリを置くので十分だと考えています。
  * git だとプッシュのたびにファイルが増えていくだけですむから、複数PCで作業しても　OneDrive の競合はしないはず… 

# 事前準備
+ 利用するソフトウェア
  + Unity
  + VCC
    + [都度、運営が指定するバージョンで。](https://creators.vrchat.com/sdk/)
  + [git](https://git-scm.com/downloads)
  + [WinMerge](https://winmerge.org/downloads/?lang=ja)
  + [Git Extensions](https://github.com/gitextensions/gitextensions/releases/latest)
    + インストールしたら git のユーザ設定とか、[autocrlf](https://light11.hatenadiary.com/entry/2020/02/23/194312) とか、WinMerge とか設定しておく。

# 流れ
### git のリポジトリを作る
* git のサーバは立てたくない・GitHubのようなサービスは使わないようにしたい。
* そのため、OneDrive にフォルダを作って、その中に git のベアリポジトリを作成。
* ローカルPCの、クラウドに同期しないフォルダで、そのノンベアリポジトリをチェックアウト。作業コピーにする。

###   VCCにて空 Unity プロジェクトを作成
この段階でVCCから ModulerAvatar や GestureManager などを入れておく。

### .gitignore を Unity プロジェクト直下に配置
  * [こちらの .gitignore を使用しています](https://qiita.com/sansuke05/items/d4dd046eef65a987ed02#git%E3%81%A7%E7%AE%A1%E7%90%86%E3%81%97%E3%81%AA%E3%81%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B)が、VCCのドキュメントでは [githubが紹介する.gitignore](https://github.com/github/gitignore/blob/main/Unity.gitignore) が案内されていますね。こっちも試さないとなあ……

### 一度Unityを起動し、import が終わったら、空プロジェクトを Git で、main リポジトリにコミット＆プッシュしておく。
  * /Library とか、 /Packages が .gitignore で除外されてコミットされないことを確認しておく。

### ベースとなる状態を作成する。
  * シェーダ導入→アバター配置の流れはもちろんのこと、そこから髪留め、めがねなど、衣装が替わっても共通で利用するアイテムを配置していく。

  * このタイミングで　ExpressionMenu からオンオフする Animation も作成
    * 昔は自分でparameterいれて、FXに追加して、Animation作って、FXに追加して…なんてやっていましたが、今は [AvatarMenuCreater for Modular Avatar](https://booth.pm/ja/items/4419509) でぽちぽち作ることが多くなりました。圧倒的に楽～～～　ありがたいです。
  * 基本の衣装で、デフォルトのFXにない衣装までオフにできる様にしておく（下着とか。今後の衣装着せ替えの事を考えて全裸になれるようにする。）

  * 一通り満足したら master(main) リポジトリにコミット＆プッシュ
    * デフォルト状態のアバターとしてはこれをアップロード

### 衣装改変
  * まず、衣装改変だけをするブランチを切る→衣装を着せる
  * もともとの衣装も使うので、削除はしない。（オーバーサイズの上着の下がタイツのみ。など最高ですよね？）
    * この衣装にこのアイテムを追加したい。などもこのタイミングで行います。
  * 衣装改変が済み次第、ブランチにコミット＆プッシュ
    * まだ後工程がある。完成形ではないのでアップロードはしない。
 
### しゃがみ置き換えやVRCLensなど、FXを大きく変更するようなアイテムを導入
  * この時、壊滅的な変更があっても戻しやすかったりテストしやすいのでブランチを切ります。

  * 満足したらアバターアップロード
    * リアル影システムなどの導入の場合、さらにこのブランチからリアル影システム用にブランチを切ったりします。

Git Extensions のツリーを見ると、このようにベース→衣装改変→FXをいじるアイテムの追加 という流れがわかります。
![](/images/vrc_avatar_git_extensions_01.png)

------------------------------

とまあ、こんな流れに落ち着きました。

git を使用することでVRCLensなどのFXをガッツリ触る壊滅的変更があっても元に戻せます。

皆さんもレッツgit
（とか言ってますが、私も git の使い方に自信が無くて。git のつかいかたがない、ざっくり流れだけのメモとなりました。）

# 補足
### liltoon などVPMで導入しない方が良い物もある
リアル影システムで使用するliltoonバージョンが固定されているので、空 Unity Projects を作ってから入れるようになりました。

### アバターのバージョンが上がったときは？
程度問題だとは思うのですが、だいたいはベースごと作り直しています。わかりやすいので。
（更新したい衣裳の分作り直さないといけない…など発生はしますが………）

### ワールド制作では
ワールド制作も
>PC版作る→コミット＆プッシュ＆アップ→ブランチ作る→Quest版作る→コミット＆プッシュ＆アップ

で、だいたい同じ流れなんですが、Target Platform とかも管理したくて、一時期は .gitignore で /Library の一部も git に入れていました。
が、 Windows / Android の切り替えの度にコンパイルするようになってしまったので、やめました。

# 悩み
### VCCが管理するVPMを git で管理できない

 /Packages フォルダにはVCCが導入する .gitignore によって、 /Packages の `com.vrchat.core.vpm-resolver` フォルダと `manifest.json` `packages-lock.json` `vpm-manifest.json` 以外はgit で管理がされない。

 /Packages/.gitignore を消してもVCCでVPM操作を行う度に .gitignore が生成される上に、編集していても元の記述に戻る。逃げられない。
[（VPMのサイトにもこの事が書いてあります。）](https://vcc.docs.vrchat.com/vpm/source-control/)

導入されたSDKやツールが最新になっている状況から、それらが古くなっているブランチに移動した場合、上記のファイルが巻き戻るため、/Packages/各フォルダの内容と各.jsonのバージョンで齟齬が発生する事になる。

しょうがないので、毎度 main ブランチに戻って、 /Packages を別の場所に退避しておき、ブランチを切り替えたら、退避して置いた /Packages で上書きしようかな…なんて考えています。脳筋。

なんかもっと楽にならないものか………
.gitignore が関係ない VCS …
Unity Version Control （Plastic SCM）とか使ってみたらいいのか…？