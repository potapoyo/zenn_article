---
title: "ぽた式 VRChat アバターセットアップ時の流れ"
emoji: "🤖"
type: "tech"
topics:
  - "git"
  - "vrchat"
published: false
---
# このページについて
* ぽたぽよがいつもしているアバターセットアップの手順を記載しています。
* あ～ こんな方法あるんですね。とか、こんな方法あるよ。など、気づきがあって、助言もらえたらいいな～みたいなきもち。

# 前提
* 1衣装 1アップロード
  * parameterの上限があるし、FX Menu をすっきりさせたい。
  * 壊滅的変更があった場合でも影響を最小限に押さえたい。
    * もちろん弊害としてアバターをガンガンアップすることになります。
      * Favorite Avatar Slots の上限はありますが、アップできるアバターの上限…はないらしい。ぽたは最近100体を超えたところです。

* git でバージョン管理をする。
  * 壊滅的変更を行っても戻せるようにする。
    * VRCLens とか リアル影システム とか しゃがみ置き換え（これは Moduler Avatar版があるのでまあいいかなあとか思い始めた。）
    * どちらかというと、なんか失敗しても簡単にコミットしたタイミングに戻したい。みたいなところが大きいかも。

* git のサーバは立てない。
  * バージョン管理がしたいのであって、サーバ管理はしたくないし、うっかり公開してしまうような状況から離れておく。
  * OneDrive にノンベアリポジトリを置くので十分だと考えています。
  * git だとプッシュのたびにファイルが増えていくだけなはず。

# 事前準備
+ 利用するソフトウェア
  + Unity
  + VCC
  + git
  + Win Merge
  + Git Extensions
    + autocrlfとか、Win Mergeとか設定しておく。

※git でのバージョン管理自体はまたいろいろあると思うので、

------------------------------

# 流れ
### git のリポジトリを作る
* git のサーバは立てたくない・GitHubのようなサービスは使わないようにする必要がある。
* OneDrive にフォルダを作って、その中にgitのノンベアリポジトリを作成。
* PCのクラウドに同期しないフォルダでそのノンベアリポジトリをチェックアウトして、ベアリポジトリにする。

###   VCCにて空 Unity プロジェクトを作成
この段階でVCCからGestureManagerなどを入れておく。

### .gitignore を Unity プロジェクト内に配置
  * この .gitignore を使用していますが、VCCのドキュメントでは こちら が案内されていますね。こっちも試さないとなあ……

### 一度空プロジェクトを Git で、main リポジトリにコミット＆プッシュしておく。
  * /Library とか、 /Packages が .gitignore で除外されてコミットされないことを確認しておく。

### ベースとなる状態を作成する。
  * シェーダ導入→アバター配置の流れはもちろんのこと、そこから髪留め、めがねなど、衣装が替わっても共通で利用するアイテムを配置していく。

  * このタイミングで　ExpressionMenu からオンオフする Animation も作成
  * 昔は自分でparameterいれて、FXに追加して、Animation作って、FXに追加して…なんてやっていましたが、今は AvatorMenuCreatorForMA でぽちぽち作ることが多くなりました。らく～～ありがたいです。
  * 基本の衣装で、初期のFXにない衣装までオフにできる様にしておく（下着とか。全裸になれるようにする。）

  * 一通り満足したら main リポジトリにコミット＆プッシュ＆アップロード

### 衣装改変
  * まず、衣装改変だけをするブランチを切ります。
    * ここで衣装を変更。
    * もともとの衣装が使えたりもするので、削除はしない。＆追加した衣装も全部オンオフ出来る様にして全裸になれるようにしておく。（オーバーサイズの上着の下がタイツのみ。など最高ですよね？）
    * この衣装にこのアイテムを追加したい。などもこのタイミングで行います。

  * 衣装改変が済み次第、ブランチにコミット＆プッシュ
    * （後工程があり、完成形ではないのでアップロードはしない。）
 
### しゃがみ置き換えやVRCLensなど、FXを大きく変更するようなアイテムを導入
  * この際、さらにブランチを切ります。
    * 壊滅的な変更があっても戻しやすかったりテストしやすいのでブランチをいちいち切ります。
      * （複数人で開発の場合はいろいろルールが発生すると思うのですが、どうせ自分しか使わないので……）

  * 満足したらアバターアップロード
    * リアル影システムなどの導入の場合、さらにこのブランチからリアル影システム用にブランチを切ったりします。


------------------------------

とまあ、こんな流れに落ち着きました。
git を使用することでVRCLensなどのFXをガッツリ触る壊滅的変更があっても元に戻せます。
皆さんもレッツgit
（とか言ってますが、私もgit なんもわからん。これも最初は初心者向け導入資料を書こうとしていたんですが、自分の能力を超えている気がしてしまっていつまでも記事が完成しないため、git のつかいかたがない、ざっくり流れだけの記事となりました。）

# 補足
## liltoon などVPMで導入しない方が良い物もある
リアル影システムで使用するliltoonバージョンが固定されているので、空 Unity Projects を作ってから入れるようになりました。


# 悩み
## VCCが管理するVPMを git で管理できない

 /Package フォルダにはVCCが導入する .gitignore によって、 /Package の `com.vrchat.core.vpm-resolver` フォルダと `manifest.json` `packages-lock.json` `vpm-manifest.json` 以外はgit で管理がされない。

 （/Package/.gitignore を消してもVCCでVPM操作を行う度に .gitignore が生成される上に、編集していてももとの記述に戻る。逃げられない。）

ブランチを行き来するため、導入されたSDKやツールが最新になっている状況から、それらが古くなっているブランチに移動した場合、上記のファイルが巻き戻るため、各フォルダの内容と各.jsonのバージョンで齟齬が発生する事になる。

しょうがないので、毎度 main ブランチに戻って、 /Package を別の場所に退避しておき、ブランチを切り替えたら、退避して置いた /Package で上書きしようかな…なんて考えています。脳筋。なんかもっとスマートにならないものか………



