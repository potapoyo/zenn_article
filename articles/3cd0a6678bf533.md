---
title: "私の VRChat アバターセットアップ時の流れ（Gitを使ってUnityでの作業を戻せるようにする）"
emoji: "📃"
type: "tech"
topics:
  - "git"
  - "vrchat"
published: false
---

# このページについて
* ぽたぽよがいつもしているアバターセットアップの手順を記載しています。
* 「アバターをUnityで調整したらなんかおかしくなった上に戻せなくなった。」
→ さらに、こういう場合に元に戻せるようにするため、git を利用します。

# このページで出来ないこと
* リポジトリのバックアップ
→ 戻せるようにする。のと、バックアップをする、は別なので、バックアップ手法ではないです。

根本的なバックアップを取りたい場合は

- プロジェクトファイルのバックアップを作成する。（VCCのバックアップ機能など…）
- github などに push する。
→ （手法としては良いと思うんですが、大体のアバターは公開禁止だと思うので、クリック数回で公開状態になるインターネットに置くのって怖くない？という気持ち）
- 自身でgitサーバを運用する

# なぜこのページを作ったの？
基本的には自分用のメモなんですが…

* Unity で Git を利用する事についてはいろんな方が解説を書いていらっしゃるのですが、Github や Gitlab や Bitbucket を利用することが前提になっているため、リビジョン管理以外に考えることが出てくると思っていて…

  - Github・BitBucket の場合は、だいたいのアバターが公開禁止だと思うので、リポジトリ非公開にする。
  - gitサーバを自身で運用する場合はそのサーバ自体の管理など…

行いたいことはリビジョン管理なので、リビジョン管理を行って、過去バージョンに戻れるようにするだけであれば、gitリポジトリを置くだけで良いはずなので、その方法をメモしました。\
（とはいえ、OneDrive に git リポジトリを置くことでバックアップにしているので、ベアリポジトリを作成しています。）

# 諸説あります。

このあたりのやり方は人によっていろいろやり方があると思うので、一例としてください。\
正義などないのだから………

# Gitとはなにか、バージョン管理システムとはなにか。

gitはバージョン管理システムの一種類になります。
さらに、バージョン管理システムとはなにか、ですが、Wikipedia を参照すると…

> ソフトウェアソースコード・ドキュメント・画像・音楽など、様々な電子ファイルは段階を経て編集される。編集の過程で履歴を保存しておけば、何度も変更を加えたファイルであっても過去の状態や変更内容を確認したり変更前の状態を復元したりできる。バージョン管理システムの基本的な機能は、このファイルの変更内容・作成変更日時の履歴保管である。\
> https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0

と、あります。

なんか難しいですが、これを使えば Unity で変更を加えるたびに記録（コミット&プッシュ）をすることで、その記録した当時の状態に戻せるということになると思います。

# インストール

アバターセットアップに必要な Unity Hub やら 指定バージョンのUnity やら VCC やらは済んでいるという前提で………

* Git Extensions のインストール
  * すでに git が入っているけど、 WinMerge はない。などのパターンもあるかなと思ったのでこれからインストール。
  * 選択肢は気にせずインストール
  * 英語で .NET Runtime がないというエラーが出たときは、 "Yes" をクリックしてダウンロードされた windowsdesktopruntime-～～～.exe をインストールしてもう一度 Git Extensions を起動。
  * 言語で日本語を選択したのちに、残っている必要な設定が出てくるかと思います。
  * ユーザ名とメールアドレスが入力されていません。\
    については、修復を押したら設定ページに飛ぶので、入力してOK…を押すんですが、OKを押すと設定画面が終了し、アプリが再起動されるので、再起動が行われますので待ちます。
    
    この設定画面は、ツール → 設定 → Git Extensions に進むと再度設定画面が表示されます。

* git for windows のインストール\
gitが入っていない。と言われたら、 https://git-scm.com/download/win にある 64-bit Git for Windows Setup. をダウンロード＆インストール。
  * 選択肢は気にせずインストール

* WinMerge インストール
  * マージツール、差分ツールを何にするか聞かれるのですが、自分はWinMerge が好きなのでコレを選択しています。
  * こちらのインストール時に Japanese Menu and Dialogs をインストールしておくと良いです。

## 設定

### core.autocrlf false

Unityでgitのautocrlfを設定しないとWindowsとMacでAssetBundleのハッシュが異なる。
https://light11.hatenadiary.com/entry/2020/02/23/194312

ということがあるらしいので、その設定を行っておきます。
（今後 Mac を使うかもしれないので…）

ツール → 設定 → Git → 設定 にある、「改行の扱い」を「そのままにする （「core.autoculf」に「false」を設定） 」にします。

ほかで git を使用していない場合は 上にある「設定の対象」を「すべてのリポジトリ全体」で選択してから OK をクリックします。


# 作業

## 保存場所について
本来ならもうノンベアリポジトリを作成するだけで良いかとは思うのですが、ベアリポジトリのみバックアップしたいので、ベアリポジトリを作成してそれをOneDriveに保存することでクラウドバックアップとします。
これはUnityでファイル読み込みをするわけではないので、置き場はHDDでも良いかも。

作業コピーがあるノンベアリポジトリはローカルの保存場所にしています。
SSDなどできるだけ速いところにあると良いと思います。

後述する .gitignore によって /Library にあるファイルは保存されないため、キャッシュなどが入っていない git リポジトリがのこります。

別の作業コピーを clone して Unity で初回読み込みを行うと、/Library の作成で Editor が開くまで時間がかかりますが、/Library だけで数GBにもなるため、その分を節約できます。

## ベアリポジトリ作成
ベアリポジトリ（git のデータのみ）を作成したいフォルダ内で右クリックし（Windows11の場合は Shift + 右クリック）、Git Ext Create new repository... をクリックして、ベアリポジトリの作成を行います。

この際に、「リポジトリの種類」は「作業ディレクトリを持たない中央リポジトリ(--bare --shared)」を選択することでベアリポジトリが作成されます。

命名規則的には
>VRC_(Avatar|World)_Name_version or note

みたいな命名規則でやっていっています。

## ベアリポジトリを clone して ノンベアリポジトリを作成

右クリック → Git Ext Clone... を選択。
先ほど作成したベアリポジトリを選択して Clone 

## VCCで空 Unity Project を作成

VRChat Creator Companion (VCC)  で AvatarやWorldのUnity  Project を作成します。

このタイミングで最初から Manage Packages から Gesture Manager や Module Avatar を導入しておくことが多いです。

liltoon はリアル影システムを利用する場合に VCC 版では利用出来ないため、後に手動で導入しています。

### Unity Editor の設定値（最近のUnityではデフォルトで行われているので必要が無いかも）

バージョン管理がしやすい形式に設定しておく。
https://qiita.com/sansuke05/items/d4dd046eef65a987ed02#unity%E3%81%AE%E8%A8%AD%E5%AE%9A

Edit → Project Settings → Editor を開きます。

Editor Settings が出てくるので、その中の
Version Control は Visible Meta Files に設定
Asset Serialization は Force Text に設定

## .gitignone の配置

Unity のProjectファイルの中で必要の無いものがあるため、
こちらを参考に、Unity Projectのフォルダの中に下記内容のテキストファイルを .gitignore という名前で作成します。
https://qiita.com/sansuke05/items/d4dd046eef65a987ed02#git%E3%81%A7%E7%AE%A1%E7%90%86%E3%81%97%E3%81%AA%E3%81%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B

## アバターを作っていく。

今回はルナトくんを作っていくので、liltoon を導入。
ルナトくんを導入。

## 1つ追加 → コミット の流れ

git を利用する理由は作業内容の記録と問題発生時に後追いができる様にする事。\
なのでコミットは細かめに行います。\
\
また、衣装を変更しても変わらない部分は最初に入れきってしまいます。\
\
髪型ををパッツンにしては保存してコミット。\
UTS2と髪留めを導入し終わったら保存してコミット。\
天使の輪っかを追加して保存してコミット\
etc... etc...\
\
という感じです。

## 戻すとき

git は一直線で記録をしていく。というものらしい（自信ない。間違っていたら誰か教えてください。）
ので、取り消しの場合は前のコミットに戻した。というコミットをする。という感じ。

戻したいコミットにリセットしてそれをコミット、プッシュ。
競合が発生するけれど、Unity が生成したデータを読むことができないので、基本的にはローカルの内容でコミットするだけという感じで………

## ブランチを切って衣装を変える

大体必要な物を載せたら、ブランチを切ってから着せたい衣装用に作業を行います。

純正衣装のパーツを期待している衣装もあると思っているので、基本的には純正衣装を削除しません。
（そのかわり前段階で純正衣装を完全にオフできる Animation と Expressionmenu は書きます。）


## ブランチを切って VRCLens を入れる。

# ポイント

## アバター編
### 





